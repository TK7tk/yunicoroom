name: Daily AI Trend Report

on:
  # æ¯Žæ—¥æ—¥æœ¬æ™‚é–“ æœ9æ™‚ã«è‡ªå‹•å®Ÿè¡Œï¼ˆUTC 0:00 = JST 9:00ï¼‰
  schedule:
    - cron: '0 0 * * *'
  
  # æ‰‹å‹•å®Ÿè¡Œã‚’è¨±å¯
  workflow_dispatch:
    inputs:
      custom_date:
        description: 'ã‚«ã‚¹ã‚¿ãƒ æ—¥ä»˜ï¼ˆYYYY-MM-DDå½¢å¼ã€çœç•¥æ™‚ã¯ä»Šæ—¥ï¼‰'
        required: false
        type: string

jobs:
  generate-report:
    runs-on: ubuntu-latest
    
    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Pythonç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          pip install requests beautifulsoup4
      
      - name: Gitè¨­å®š
        run: |
          git config --global user.name "Manus AI Bot"
          git config --global user.email "ai-bot@manus.im"
      
      - name: AIå‹•å‘ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
        env:
          CUSTOM_DATE: ${{ github.event.inputs.custom_date }}
        run: |
          echo "ðŸš€ AIå‹•å‘ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚’é–‹å§‹..."
          
          # ã‚«ã‚¹ã‚¿ãƒ æ—¥ä»˜ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ä½¿ç”¨
          if [ -n "$CUSTOM_DATE" ]; then
            DATE="$CUSTOM_DATE"
            echo "ðŸ“… ã‚«ã‚¹ã‚¿ãƒ æ—¥ä»˜ã‚’ä½¿ç”¨: $DATE"
          else
            DATE=$(date +%Y-%m-%d)
            echo "ðŸ“… ä»Šæ—¥ã®æ—¥ä»˜ã‚’ä½¿ç”¨: $DATE"
          fi
          
          # articlesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
          mkdir -p articles
          
          # ãƒ¬ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å
          REPORT_FILE="articles/${DATE}_ai-trend-report.md"
          
          # ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆï¼ˆå®Ÿéš›ã®é‹ç”¨ã§ã¯å¤–éƒ¨APIã‚„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å‘¼ã³å‡ºã—ï¼‰
          cat > "$REPORT_FILE" << EOF
          ## ðŸ“Š ä»Šæ—¥ã®US AIå‹•å‘ã‚µãƒžãƒªãƒ¼ï¼ˆ${DATE}ï¼‰
          
          [ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸ]
          
          ### ðŸ”¥ AIåŸºç›¤æŠ€è¡“ãƒ‹ãƒ¥ãƒ¼ã‚¹
          
          **ä¸»è¦ãƒ¢ãƒ‡ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ**
          æœ€æ–°ã®AIåŸºç›¤ãƒ¢ãƒ‡ãƒ«ã«é–¢ã™ã‚‹å‹•å‘ã‚’åˆ†æžã—ã¾ã™ã€‚
          
          ### ðŸš€ æ–°èˆˆä¼æ¥­ãƒ»ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—å‹•å‘
          
          **è³‡é‡‘èª¿é”ã¨ãƒ­ãƒ¼ãƒ³ãƒæƒ…å ±**
          æ–°èˆˆä¼æ¥­ã®æœ€æ–°å‹•å‘ã‚’ã‚«ãƒãƒ¼ã—ã¾ã™ã€‚
          
          ### ðŸŒŸ æˆ¦ç•¥çš„ã‚¤ãƒ³ã‚µã‚¤ãƒˆã¨å±•æœ›
          
          ä»Šå¾Œã®å¸‚å ´å‹•å‘ã¨æˆ¦ç•¥çš„ç¤ºå”†ã‚’æä¾›ã—ã¾ã™ã€‚
          
          ---
          
          ### å‚è€ƒæ–‡çŒ®
          
          [1] æƒ…å ±æº1
          [2] æƒ…å ±æº2
          
          ---
          
          *ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯GitHub Actionsã«ã‚ˆã‚Šè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸ*
          EOF
          
          echo "âœ… ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†: $REPORT_FILE"
          
          # ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’ç¢ºèª
          ls -lh "$REPORT_FILE"
      
      - name: GitHubã«ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
        run: |
          # å¤‰æ›´ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
          if git diff --quiet && git diff --staged --quiet; then
            echo "âš ï¸  å¤‰æ›´ãŒãªã„ãŸã‚ã‚³ãƒŸãƒƒãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™"
            exit 0
          fi
          
          # å¤‰æ›´ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°
          git add articles/*.md
          
          # ã‚³ãƒŸãƒƒãƒˆ
          DATE=$(date +%Y-%m-%d)
          git commit -m "AIå‹•å‘ãƒ¬ãƒãƒ¼ãƒˆ ${DATE}: è‡ªå‹•ç”Ÿæˆ" || echo "ã‚³ãƒŸãƒƒãƒˆã™ã‚‹å¤‰æ›´ãŒã‚ã‚Šã¾ã›ã‚“"
          
          # ãƒ—ãƒƒã‚·ãƒ¥
          git push origin main || echo "ãƒ—ãƒƒã‚·ãƒ¥ã«å¤±æ•—ã—ã¾ã—ãŸ"
          
          echo "âœ… GitHubã¸ã®ãƒ—ãƒƒã‚·ãƒ¥å®Œäº†"
      
      - name: å®Ÿè¡Œçµæžœã‚µãƒžãƒªãƒ¼
        if: always()
        run: |
          echo "=================================="
          echo "ðŸ“Š å®Ÿè¡Œçµæžœã‚µãƒžãƒªãƒ¼"
          echo "=================================="
          echo "æ—¥ä»˜: $(date)"
          echo "ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«:"
          ls -lh articles/*.md | tail -5
          echo "=================================="
      
      # LINEé…ä¿¡ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼šã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿å®Ÿè¡Œï¼‰
      # - name: LINEé…ä¿¡
      #   if: ${{ secrets.LINE_CHANNEL_ACCESS_TOKEN }}
      #   env:
      #     LINE_TOKEN: ${{ secrets.LINE_CHANNEL_ACCESS_TOKEN }}
      #   run: |
      #     python3 scripts/send_to_line.py
